# ============================================================================
# NES Linker Configuration for ca65/ld65
# ============================================================================
#
# This file tells the linker how to organize our code and data into the
# final .nes ROM file. It defines:
#   1. MEMORY  - Physical regions in the output file
#   2. SEGMENTS - Logical sections of our code/data that map into memory
#
# An NES ROM file (in iNES format) has this structure:
#   - 16-byte header (identifies it as an NES ROM)
#   - PRG-ROM banks (program code, mapped to CPU $8000-$FFFF)
#   - CHR-ROM banks (graphics data, mapped to PPU $0000-$1FFF)
#
# For our simple Hello World, we use the simplest mapper (mapper 0 / NROM):
#   - 1 x 16KB PRG-ROM bank (CPU $C000-$FFFF)
#   - 1 x 8KB CHR-ROM bank  (PPU $0000-$1FFF)
# ============================================================================

MEMORY {
    # The 16-byte iNES header. Every NES ROM starts with this.
    HEADER:   start = $0000, size = $0010, type = ro, file = %O, fill = yes;

    # Zero Page RAM ($0000-$00FF on the CPU).
    # The 6502 has special fast instructions for this page, so it's prime
    # real estate for frequently-used variables.
    ZEROPAGE: start = $00,   size = $0100, type = rw, define = yes;

    # General-purpose RAM ($0200-$07FF on the CPU).
    # $0100-$01FF is the stack (used automatically by the 6502), so we
    # start our general RAM at $0200. The NES has 2KB total ($0000-$07FF).
    RAM:      start = $0200, size = $0600, type = rw, define = yes;

    # OAM (Object Attribute Memory) buffer at $0200.
    # We reserve a page for sprite data that gets DMA'd to the PPU.
    # (Not used in this Hello World, but good practice to reserve it.)
    OAM:      start = $0200, size = $0100, type = rw, define = yes;

    # PRG-ROM: 16KB of program code, mapped to CPU $C000-$FFFF.
    # With mapper 0 and only 16KB, it mirrors at both $8000 and $C000,
    # but the CPU starts execution based on the reset vector at $FFFC,
    # which is in the $C000-$FFFF range.
    PRG:      start = $C000, size = $4000, type = ro, file = %O, fill = yes;

    # CHR-ROM: 8KB of graphics data, loaded into PPU pattern tables.
    CHR:      start = $0000, size = $2000, type = ro, file = %O, fill = yes;
}

SEGMENTS {
    # Each segment in our assembly code gets placed into a memory region.

    HEADER:   load = HEADER,   type = ro;
    ZEROPAGE: load = ZEROPAGE, type = zp;
    BSS:      load = RAM,      type = bss;            # Uninitialized variables
    OAM:      load = OAM,      type = bss;            # Sprite buffer
    CODE:     load = PRG,      type = ro,  start = $C000;  # Our program code
    RODATA:   load = PRG,      type = ro;              # Read-only data (strings, tables)
    VECTORS:  load = PRG,      type = ro,  start = $FFFA;  # Interrupt vectors (MUST be at $FFFA)
    CHARS:    load = CHR,      type = ro;              # Graphics tile data
}
